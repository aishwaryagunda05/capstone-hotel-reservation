<div class="page-container" style="padding: 2rem;">

  <!-- Loading State -->
  <div *ngIf="loading"
    style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 6rem 2rem;">
    <div class="spinner-container" style="position: relative;">
      <mat-spinner diameter="50"></mat-spinner>
    </div>
    <p style="margin-top: 1.5rem; color: #64748b; font-weight: 500; font-family: 'Outfit', sans-serif;">{{
      loadingMessage }}</p>
    <button *ngIf="loading && (loadingMessage.includes('longer') || loadingMessage.includes('Connecting'))"
      (click)="loadData()"
      style="margin-top: 1rem; padding: 8px 16px; background: white; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; color: #4f46e5; font-weight: 600;">
      Try Again
    </button>
  </div>
  <div *ngIf="!selectedHotelId && !loading" class="hotel-selection">
    <div *ngIf="hotels.length > 0">
      <div style="margin-bottom: 2rem;">
        <h2 style="font-size: 2rem; font-weight: 700; color: #1e293b;">Select Hotel</h2>
        <p style="color: #64748b;">Choose a hotel to manage its inventory</p>
      </div>

      <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 24px;">
        <div *ngFor="let hotel of hotels" class="hotel-card" (click)="selectHotel(hotel.hotelId)"
          style="background: white; padding: 24px; border-radius: 16px; border: 1px solid #e2e8f0; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);">
          <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
            <div
              style="width: 56px; height: 56px; background: #f5f3ff; border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
              <span class="iconify" data-icon="mdi:office-building-marker"
                style="font-size: 28px; color: #7c3aed;"></span>
            </div>
            <div>
              <h3 style="font-size: 1.25rem; font-weight: 600; color: #1e293b; margin: 0; line-height: 1.2;">{{
                hotel.hotelName }}</h3>
              <p
                style="color: #64748b; margin: 4px 0 0 0; font-size: 0.875rem; display: flex; align-items: center; gap: 4px;">
                <span class="iconify" data-icon="mdi:map-marker-outline"></span>
                {{ hotel.city || 'City not set' }}
              </p>
            </div>
          </div>

          <div *ngIf="hotel.address"
            style="margin-bottom: 20px; font-size: 0.875rem; color: #94a3b8; line-height: 1.5;">
            {{ hotel.address }}
          </div>

          <button
            style="width: 100%; padding: 12px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 10px; color: #4f46e5; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
            Open Management
            <span class="iconify" data-icon="mdi:chevron-right"></span>
          </button>
        </div>
      </div>
    </div>
    <div *ngIf="hotels.length === 0"
      style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 4rem 2rem; background: #f8fafc; border-radius: 24px; border: 2px dashed #e2e8f0;">
      <div
        style="width: 80px; height: 80px; background: #f1f5f9; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 1.5rem;">
        <span class="iconify" data-icon="mdi:home-alert-outline" style="font-size: 40px; color: #94a3b8;"></span>
      </div>
      <h3 style="font-size: 1.5rem; font-weight: 700; color: #1e293b; margin-bottom: 0.5rem;">No Hotels Found</h3>
      <p style="color: #64748b; text-align: center; max-width: 400px; margin-bottom: 2rem;">
        You haven't been assigned to any hotels yet. If you believe this is an error, please contact your administrator.
      </p>
    </div>
  </div>

  <!-- 2. Room List View -->
  <div *ngIf="selectedHotelId" class="room-list-view">
    <div class="page-header"
      style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
      <div style="display: flex; align-items: center; gap: 16px;">
        <button *ngIf="hotels.length > 1" (click)="goBackToHotels()" class="btn-icon"
          style="background: white; border: 1px solid #e2e8f0; width: 40px; height: 40px; border-radius: 50%;">
          <span class="iconify" data-icon="mdi:arrow-left" style="font-size: 1.25rem; color: #64748b;"></span>
        </button>
        <div>
          <h2 style="font-size: 1.8rem; font-weight: 700; color: #1e293b; letter-spacing: -0.02em; margin:0;">
            Manage Rooms
          </h2>
          <p style="color: #64748b; margin-top:0.5rem;" *ngIf="selectedHotelId">
            Inventory for {{ getSelectedHotelName() }}
          </p>
        </div>
      </div>

      <button class="premium-add-btn" (click)="openAddDialog()">
        <span class="iconify" data-icon="mdi:plus" style="font-size: 1.5rem;"></span>
        Add Room
      </button>
    </div>

    <div class="mat-elevation-z0"
      style="background: white; border-radius: 16px; border: 1px solid #e2e8f0; overflow: hidden;">
      <table mat-table [dataSource]="dataSource" class="w-full table-premium">
        <ng-container matColumnDef="roomNumber">
          <th mat-header-cell *matHeaderCellDef> Room No. </th>
          <td mat-cell *matCellDef="let room">
            <span style="font-weight: 600; color: #1e293b; font-family: 'Outfit', sans-serif;">{{ room.roomNumber
              }}</span>
          </td>
        </ng-container>
        <ng-container matColumnDef="roomType">
          <th mat-header-cell *matHeaderCellDef> Type </th>
          <td mat-cell *matCellDef="let room" style="color: #64748b;"> {{ getRoomTypeName(room.roomTypeId) }}
          </td>
        </ng-container>
        <ng-container matColumnDef="price">
          <th mat-header-cell *matHeaderCellDef> Price </th>
          <td mat-cell *matCellDef="let room" style="font-weight: 600; color: #0f172a;"> {{
            getRoomPrice(room.roomTypeId) | currency:'INR' }} </td>
        </ng-container>
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef> Status </th>
          <td mat-cell *matCellDef="let room">
            <span class="status-badge" [ngClass]="{
                    'status-active': room.status === 'Available',
                    'status-inactive': room.status === 'Unavailable' || room.status === 'Booked',
                    'status-pending': room.status === 'Maintenance' || room.status === 'Undermaintenance'
                  }">
              {{ room.status }}
            </span>
          </td>
        </ng-container>
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef> Actions </th>
          <td mat-cell *matCellDef="let room">
            <div style="display: flex; gap: 8px;">
              <button class="btn-icon btn-edit" (click)="openEditDialog(room)" title="Edit">
                <span class="iconify" data-icon="mdi:pencil-outline"></span>
              </button>
              <button class="btn-icon btn-delete" (click)="deleteRoom(room.roomId)" title="Delete">
                <span class="iconify" data-icon="mdi:trash-can-outline"></span>
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <!-- Empty State -->
      <div *ngIf="dataSource.data.length === 0 && !loading" style="padding: 3rem; text-align: center; color: #94a3b8;">
        <span class="iconify" data-icon="mdi:bed-empty"
          style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></span>
        <p>No rooms found for this hotel.</p>
      </div>
    </div>
  </div>
</div>